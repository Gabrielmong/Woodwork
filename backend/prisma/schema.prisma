// Prisma schema for Woodwork Calculator

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                String    @id @default(uuid())
  username          String    @unique
  email             String?   @unique
  password          String    // bcrypt hashed password
  firstName         String
  lastName          String
  dateOfBirth       DateTime?
  hasAcceptedTerms  Boolean   @default(false)
  imageData         String?   @db.Text // Base64 encoded profile image
  isDeleted         Boolean   @default(false)
  createdAt         DateTime  @default(now())
  updatedAt         DateTime  @updatedAt

  // Relations
  lumber            Lumber[]
  finishes          Finish[]
  sheetGoods        SheetGood[]
  projects          Project[]
  tools             Tool[]
  settings          Settings?

  @@index([username])
  @@index([email])
  @@index([isDeleted])
  @@map("users")
}

model Lumber {
  id               String    @id @default(uuid())
  name             String
  description      String
  jankaRating      Float
  costPerBoardFoot Float
  tags             String[]
  isDeleted        Boolean   @default(false)
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt

  // Relations
  userId           String
  user             User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  boards           Board[]

  @@index([userId])
  @@index([isDeleted])
  @@map("lumber")
}

model Finish {
  id          String    @id @default(uuid())
  name        String
  description String
  price       Float
  tags        String[]
  storeLink   String?
  imageData   String?   @db.Text // Base64 encoded image
  isDeleted   Boolean   @default(false)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  userId      String
  user        User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  projects    Project[] @relation("ProjectFinishes")

  @@index([userId])
  @@index([isDeleted])
  @@map("finishes")
}

model SheetGood {
  id                String             @id @default(uuid())
  name              String
  description       String
  width             Float              // inches
  length            Float              // inches
  thickness         Float              // inches
  price             Float
  materialType      String             // aglomerate, ply, melamine, etc
  tags              String[]
  isDeleted         Boolean            @default(false)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  // Relations
  userId            String
  user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  projectSheetGoods ProjectSheetGood[]

  @@index([userId])
  @@index([isDeleted])
  @@map("sheet_goods")
}

enum ProjectStatus {
  PLANNED
  IN_PROGRESS
  FINISHING
  COMPLETED
}

model Project {
  id                String             @id @default(uuid())
  name              String
  description       String
  status            ProjectStatus      @default(PLANNED)
  laborCost         Float              @default(0)
  miscCost          Float              @default(0)
  additionalNotes   String?
  isDeleted         Boolean            @default(false)
  createdAt         DateTime           @default(now())
  updatedAt         DateTime           @updatedAt

  // Relations
  userId            String
  user              User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  boards            Board[]
  finishes          Finish[]           @relation("ProjectFinishes")
  projectSheetGoods ProjectSheetGood[]

  @@index([userId])
  @@index([isDeleted])
  @@index([status])
  @@map("projects")
}

model Board {
  id         String   @id @default(uuid())
  width      Float    // inches
  thickness  Float    // inches
  length     Float    // varas
  quantity   Int
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  // Relations
  projectId  String
  project    Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  lumberId   String
  lumber     Lumber   @relation(fields: [lumberId], references: [id])

  @@index([projectId])
  @@index([lumberId])
  @@map("boards")
}

model ProjectSheetGood {
  id          String    @id @default(uuid())
  quantity    Int
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // Relations
  projectId   String
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)

  sheetGoodId String
  sheetGood   SheetGood @relation(fields: [sheetGoodId], references: [id])

  @@index([projectId])
  @@index([sheetGoodId])
  @@map("project_sheet_goods")
}

model Tool {
  id           String    @id @default(uuid())
  name         String
  description  String
  function     String    // What the tool is used for
  price        Float
  serialNumber String?
  imageData    String?   @db.Text // Base64 encoded image
  isDeleted    Boolean   @default(false)
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt

  // Relations
  userId       String
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isDeleted])
  @@map("tools")
}

model Settings {
  id        String   @id @default(uuid())
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  currency  String   @default("USD") // 'CRC' or 'USD'
  language  String   @default("en")  // 'en' or 'es'
  themeMode String   @default("light") // 'light' or 'dark'
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("settings")
}
